openapi: 3.0.3
info:
  title: MakeBelieve Imprints API
  description: |
    REST API for the MakeBelieve Imprints custom print service platform.

    ## Authentication
    This API uses JWT tokens stored in HTTP-only cookies.
    - Access tokens expire after 15 minutes
    - Refresh tokens expire after 7 days
    - Call POST /api/auth/refresh to refresh expired access tokens

    ## Rate Limiting
    - Global: 100 requests per 15 minutes
    - Auth endpoints: 5 requests per 15 minutes
    - Payment endpoints: 10 requests per hour
    - Order creation: 10 requests per hour
    - File uploads: 20 requests per hour
    - Public endpoints: 200 requests per 15 minutes
  version: 0.1.0
  contact:
    name: MakeBelieve Imprints
    url: https://makebelieveimprints.co.uk
  license:
    name: Proprietary

servers:
  - url: https://mkbl.vercel.app/api
    description: Production server
  - url: http://localhost:3000/api
    description: Development server

tags:
  - name: Auth
    description: Authentication and authorization
  - name: Users
    description: User management
  - name: Designs
    description: User design management
  - name: Products
    description: Product catalog
  - name: Categories
    description: Product categories and subcategories
  - name: Templates
    description: Design templates
  - name: Orders
    description: Order management
  - name: Reviews
    description: Customer reviews
  - name: Invoices
    description: Invoice management
  - name: Payments
    description: Payment processing
  - name: Shipping
    description: Royal Mail shipping integration
  - name: Uploads
    description: File upload management
  - name: Health
    description: Health checks

paths:
  # ==================== AUTH ====================
  /auth/register:
    post:
      tags: [Auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: Email already exists

  /auth/login:
    post:
      tags: [Auth]
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              description: HTTP-only access and refresh token cookies
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout user
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Logged out successfully

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      description: Uses the refresh token from cookies to issue a new access token
      responses:
        '200':
          description: Token refreshed
        '401':
          description: Invalid or expired refresh token

  /auth/me:
    get:
      tags: [Auth]
      summary: Get current user
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Current user info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ==================== USERS ====================
  /users/me:
    get:
      tags: [Users]
      summary: Get current user profile
      security:
        - cookieAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
    put:
      tags: [Users]
      summary: Update current user profile
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'

  /users:
    get:
      tags: [Users]
      summary: List all users (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsersListResponse'
        '403':
          $ref: '#/components/responses/Forbidden'

  /users/{id}:
    get:
      tags: [Users]
      summary: Get user by ID (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Users]
      summary: Delete user (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: User deleted
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== DESIGNS ====================
  /designs:
    get:
      tags: [Designs]
      summary: List designs
      description: Returns user's own designs (or all for admin)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: List of designs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DesignsListResponse'
    post:
      tags: [Designs]
      summary: Create a new design
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDesignRequest'
      responses:
        '201':
          description: Design created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DesignResponse'

  /designs/{id}:
    get:
      tags: [Designs]
      summary: Get design by ID
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Design details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DesignResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Designs]
      summary: Update design
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDesignRequest'
      responses:
        '200':
          description: Design updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DesignResponse'
    delete:
      tags: [Designs]
      summary: Delete design
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Design deleted

  # ==================== PRODUCTS ====================
  /products:
    get:
      tags: [Products]
      summary: List products
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: categorySlug
          in: query
          schema:
            type: string
        - name: subcategorySlug
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [name, price, createdAt, featured]
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [asc, desc]
        - name: featured
          in: query
          schema:
            type: boolean
        - name: materials
          in: query
          description: Comma-separated list of materials
          schema:
            type: string
        - name: sizes
          in: query
          description: Comma-separated list of sizes
          schema:
            type: string
        - name: minPrice
          in: query
          schema:
            type: number
        - name: maxPrice
          in: query
          schema:
            type: number
      responses:
        '200':
          description: List of products
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductsListResponse'
    post:
      tags: [Products]
      summary: Create product (admin only)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductRequest'
      responses:
        '201':
          description: Product created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'

  /products/{id}:
    get:
      tags: [Products]
      summary: Get product by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Product details with variants and images
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Products]
      summary: Update product (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProductRequest'
      responses:
        '200':
          description: Product updated
    delete:
      tags: [Products]
      summary: Delete product (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Product deleted

  /products/{id}/variants:
    get:
      tags: [Products]
      summary: Get product variants
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: List of variants
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductVariant'
    post:
      tags: [Products]
      summary: Add variant to product (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateVariantRequest'
      responses:
        '201':
          description: Variant created

  /products/{id}/templates:
    get:
      tags: [Products]
      summary: Get product templates
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: List of templates
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductTemplate'

  /products/filters:
    get:
      tags: [Products]
      summary: Get available filter options
      parameters:
        - name: category
          in: query
          schema:
            type: string
        - name: productType
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Filter options
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FiltersResponse'

  # ==================== CATEGORIES ====================
  /categories:
    get:
      tags: [Categories]
      summary: List all categories
      responses:
        '200':
          description: List of categories with subcategories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
    post:
      tags: [Categories]
      summary: Create category (admin only)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCategoryRequest'
      responses:
        '201':
          description: Category created

  /categories/{id}:
    get:
      tags: [Categories]
      summary: Get category by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Category details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
    put:
      tags: [Categories]
      summary: Update category (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCategoryRequest'
      responses:
        '200':
          description: Category updated
    delete:
      tags: [Categories]
      summary: Delete category (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Category deleted

  /categories/{id}/subcategories:
    get:
      tags: [Categories]
      summary: Get subcategories for a category
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: List of subcategories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Subcategory'

  # ==================== TEMPLATES ====================
  /templates:
    get:
      tags: [Templates]
      summary: List all templates
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: category
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
        - name: isPremium
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of templates
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplatesListResponse'
    post:
      tags: [Templates]
      summary: Create template (admin only)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTemplateRequest'
      responses:
        '201':
          description: Template created

  /templates/{id}:
    put:
      tags: [Templates]
      summary: Update template (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTemplateRequest'
      responses:
        '200':
          description: Template updated
    delete:
      tags: [Templates]
      summary: Delete template (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Template deleted

  # ==================== ORDERS ====================
  /orders:
    get:
      tags: [Orders]
      summary: List orders
      description: Returns user's own orders (or all for admin)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/OrderStatus'
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrdersListResponse'
    post:
      tags: [Orders]
      summary: Create a new order
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'

  /orders/{id}:
    get:
      tags: [Orders]
      summary: Get order by ID
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /orders/{id}/status:
    put:
      tags: [Orders]
      summary: Update order status (admin only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  $ref: '#/components/schemas/OrderStatus'
      responses:
        '200':
          description: Order status updated

  /orders/{id}/download/{itemId}:
    get:
      tags: [Orders]
      summary: Get download link for digital product
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
        - name: itemId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Download link
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      downloadUrl:
                        type: string
                      expiresAt:
                        type: string
                        format: date-time
                      fileName:
                        type: string

  /orders/user/downloads:
    get:
      tags: [Orders]
      summary: List user's digital downloads
      security:
        - cookieAuth: []
      responses:
        '200':
          description: List of digital downloads
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DownloadsListResponse'

  # ==================== REVIEWS ====================
  /reviews:
    get:
      tags: [Reviews]
      summary: List reviews
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: List of reviews
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReviewsListResponse'
    post:
      tags: [Reviews]
      summary: Create a review
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReviewRequest'
      responses:
        '201':
          description: Review created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReviewResponse'

  /reviews/{id}:
    get:
      tags: [Reviews]
      summary: Get review by ID
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Review details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReviewResponse'
    delete:
      tags: [Reviews]
      summary: Delete review
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Review deleted

  # ==================== INVOICES ====================
  /invoices:
    get:
      tags: [Invoices]
      summary: List invoices
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: List of invoices
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvoicesListResponse'

  /invoices/{id}:
    get:
      tags: [Invoices]
      summary: Get invoice by ID
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Invoice details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvoiceResponse'

  /invoices/{id}/pdf:
    get:
      tags: [Invoices]
      summary: Download invoice PDF
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: PDF download URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      pdfUrl:
                        type: string

  # ==================== PAYMENTS ====================
  /payments:
    get:
      tags: [Payments]
      summary: List payments
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/PaymentStatus'
      responses:
        '200':
          description: List of payments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentsListResponse'
    post:
      tags: [Payments]
      summary: Process a payment
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProcessPaymentRequest'
      responses:
        '200':
          description: Payment processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'

  /payments/{id}:
    get:
      tags: [Payments]
      summary: Get payment by ID
      security:
        - cookieAuth: []
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Payment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'

  # ==================== SHIPPING ====================
  /shipping/shipments:
    post:
      tags: [Shipping]
      summary: Create Royal Mail shipment label
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateShipmentRequest'
      responses:
        '200':
          description: Shipment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShipmentResponse'

  /shipping/tracking/{trackingNumber}:
    get:
      tags: [Shipping]
      summary: Track a shipment
      parameters:
        - name: trackingNumber
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Tracking information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrackingResponse'

  /shipping/health:
    get:
      tags: [Shipping]
      summary: Check Royal Mail API health
      responses:
        '200':
          description: API health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        enum: [healthy, degraded, down]
                      responseTime:
                        type: number

  # ==================== UPLOADS ====================
  /uploads/request-url:
    get:
      tags: [Uploads]
      summary: Get signed upload URL
      security:
        - cookieAuth: []
      parameters:
        - name: filename
          in: query
          required: true
          schema:
            type: string
        - name: contentType
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Signed URL for upload
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      uploadUrl:
                        type: string
                      fileKey:
                        type: string
                      expiresAt:
                        type: string
                        format: date-time

  /uploads/download/{key}:
    get:
      tags: [Uploads]
      summary: Get signed download URL
      security:
        - cookieAuth: []
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Signed URL for download

  /uploads/{key}:
    delete:
      tags: [Uploads]
      summary: Delete uploaded file
      security:
        - cookieAuth: []
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: File deleted

  /uploads/health:
    get:
      tags: [Uploads]
      summary: Check storage health
      responses:
        '200':
          description: Storage health status

  # ==================== HEALTH ====================
  /health:
    get:
      tags: [Health]
      summary: API health check
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: access_token
      description: JWT access token stored in HTTP-only cookie

  parameters:
    Id:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    Page:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
    Limit:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    # ===== Common =====
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

    # ===== Auth =====
    RegisterRequest:
      type: object
      required:
        - email
        - password
        - name
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        name:
          type: string
          minLength: 1
          maxLength: 255

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'

    # ===== User =====
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        type:
          type: string
          enum: [customer, admin]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'

    UsersListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            users:
              type: array
              items:
                $ref: '#/components/schemas/User'
            pagination:
              $ref: '#/components/schemas/Pagination'

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string

    # ===== Design =====
    Design:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        imageUrl:
          type: string
        thumbnailUrl:
          type: string
        printSize:
          $ref: '#/components/schemas/PrintSize'
        material:
          $ref: '#/components/schemas/Material'
        orientation:
          $ref: '#/components/schemas/Orientation'
        customWidth:
          type: integer
        customHeight:
          type: integer
        createdAt:
          type: string
          format: date-time

    CreateDesignRequest:
      type: object
      required:
        - name
        - imageUrl
        - printSize
        - material
        - orientation
      properties:
        name:
          type: string
        description:
          type: string
        imageUrl:
          type: string
        thumbnailUrl:
          type: string
        printSize:
          $ref: '#/components/schemas/PrintSize'
        material:
          $ref: '#/components/schemas/Material'
        orientation:
          $ref: '#/components/schemas/Orientation'
        customWidth:
          type: integer
        customHeight:
          type: integer

    UpdateDesignRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        imageUrl:
          type: string
        printSize:
          $ref: '#/components/schemas/PrintSize'
        material:
          $ref: '#/components/schemas/Material'
        orientation:
          $ref: '#/components/schemas/Orientation'

    DesignResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            design:
              $ref: '#/components/schemas/Design'

    DesignsListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            designs:
              type: array
              items:
                $ref: '#/components/schemas/Design'
            pagination:
              $ref: '#/components/schemas/Pagination'

    # ===== Product =====
    Product:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        description:
          type: string
        categoryId:
          type: string
          format: uuid
        subcategoryId:
          type: string
          format: uuid
        category:
          $ref: '#/components/schemas/Category'
        subcategory:
          $ref: '#/components/schemas/Subcategory'
        customizationType:
          $ref: '#/components/schemas/CustomizationType'
        basePrice:
          type: number
        currency:
          type: string
        status:
          $ref: '#/components/schemas/ProductStatus'
        featured:
          type: boolean
        images:
          type: array
          items:
            $ref: '#/components/schemas/ProductImage'
        variants:
          type: array
          items:
            $ref: '#/components/schemas/ProductVariant'
        templates:
          type: array
          items:
            $ref: '#/components/schemas/ProductTemplate'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ProductImage:
      type: object
      properties:
        id:
          type: string
          format: uuid
        imageUrl:
          type: string
        altText:
          type: string
        displayOrder:
          type: integer
        isPrimary:
          type: boolean

    ProductVariant:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        sku:
          type: string
        size:
          type: string
        color:
          type: string
        material:
          type: string
        finish:
          type: string
        price:
          type: number
        stock:
          type: integer
        isDefault:
          type: boolean

    ProductTemplate:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        thumbnailUrl:
          type: string
        designFileUrl:
          type: string
        category:
          type: string
        isPremium:
          type: boolean
        price:
          type: number

    CreateProductRequest:
      type: object
      required:
        - name
        - description
        - categoryId
        - customizationType
        - basePrice
      properties:
        name:
          type: string
        description:
          type: string
        categoryId:
          type: string
          format: uuid
        subcategoryId:
          type: string
          format: uuid
        customizationType:
          $ref: '#/components/schemas/CustomizationType'
        basePrice:
          type: number
        featured:
          type: boolean

    UpdateProductRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        basePrice:
          type: number
        status:
          $ref: '#/components/schemas/ProductStatus'
        featured:
          type: boolean

    CreateVariantRequest:
      type: object
      required:
        - name
        - price
      properties:
        name:
          type: string
        sku:
          type: string
        size:
          type: string
        color:
          type: string
        material:
          type: string
        finish:
          type: string
        price:
          type: number
        stock:
          type: integer
        isDefault:
          type: boolean

    ProductResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            product:
              $ref: '#/components/schemas/Product'

    ProductsListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            products:
              type: array
              items:
                $ref: '#/components/schemas/Product'
            pagination:
              $ref: '#/components/schemas/Pagination'

    FiltersResponse:
      type: object
      properties:
        materials:
          type: array
          items:
            type: object
            properties:
              value:
                type: string
              count:
                type: integer
        sizes:
          type: array
          items:
            type: object
            properties:
              value:
                type: string
              count:
                type: integer
        priceRange:
          type: object
          properties:
            min:
              type: number
            max:
              type: number

    # ===== Category =====
    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        description:
          type: string
        image:
          type: string
        displayOrder:
          type: integer
        isActive:
          type: boolean
        subcategories:
          type: array
          items:
            $ref: '#/components/schemas/Subcategory'

    Subcategory:
      type: object
      properties:
        id:
          type: string
          format: uuid
        categoryId:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        description:
          type: string
        image:
          type: string
        displayOrder:
          type: integer
        isActive:
          type: boolean

    CreateCategoryRequest:
      type: object
      required:
        - name
        - slug
      properties:
        name:
          type: string
        slug:
          type: string
        description:
          type: string
        image:
          type: string
        displayOrder:
          type: integer
        isActive:
          type: boolean

    UpdateCategoryRequest:
      type: object
      properties:
        name:
          type: string
        slug:
          type: string
        description:
          type: string
        image:
          type: string
        displayOrder:
          type: integer
        isActive:
          type: boolean

    # ===== Template =====
    CreateTemplateRequest:
      type: object
      required:
        - productId
        - name
        - thumbnailUrl
        - designFileUrl
      properties:
        productId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        thumbnailUrl:
          type: string
        designFileUrl:
          type: string
        category:
          type: string
        isPremium:
          type: boolean
        price:
          type: number

    UpdateTemplateRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        thumbnailUrl:
          type: string
        designFileUrl:
          type: string
        category:
          type: string
        isPremium:
          type: boolean
        price:
          type: number

    TemplatesListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            templates:
              type: array
              items:
                $ref: '#/components/schemas/ProductTemplate'
            pagination:
              $ref: '#/components/schemas/Pagination'

    # ===== Order =====
    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        customerId:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/OrderStatus'
        totalPrice:
          type: number
        shippingAddress:
          $ref: '#/components/schemas/ShippingAddress'
        trackingNumber:
          type: string
        carrier:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    OrderItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        productId:
          type: string
          format: uuid
        variantId:
          type: string
          format: uuid
        designId:
          type: string
          format: uuid
        quantity:
          type: integer
        unitPrice:
          type: number
        totalPrice:
          type: number

    ShippingAddress:
      type: object
      properties:
        name:
          type: string
        addressLine1:
          type: string
        addressLine2:
          type: string
        city:
          type: string
        county:
          type: string
        postcode:
          type: string
        country:
          type: string
        phone:
          type: string

    CreateOrderRequest:
      type: object
      required:
        - shippingAddress
        - totalPrice
      properties:
        designId:
          type: string
          format: uuid
        printSize:
          $ref: '#/components/schemas/PrintSize'
        material:
          $ref: '#/components/schemas/Material'
        orientation:
          $ref: '#/components/schemas/Orientation'
        shippingAddress:
          $ref: '#/components/schemas/ShippingAddress'
        totalPrice:
          type: number
        items:
          type: array
          items:
            type: object
            properties:
              productId:
                type: string
                format: uuid
              variantId:
                type: string
                format: uuid
              designId:
                type: string
                format: uuid
              quantity:
                type: integer
              unitPrice:
                type: number

    OrderResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            order:
              $ref: '#/components/schemas/Order'

    OrdersListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            orders:
              type: array
              items:
                $ref: '#/components/schemas/Order'
            pagination:
              $ref: '#/components/schemas/Pagination'

    DownloadsListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            downloads:
              type: array
              items:
                type: object
                properties:
                  orderId:
                    type: string
                    format: uuid
                  orderItemId:
                    type: string
                    format: uuid
                  orderDate:
                    type: string
                    format: date-time
                  orderStatus:
                    $ref: '#/components/schemas/OrderStatus'
                  product:
                    $ref: '#/components/schemas/Product'
                  quantity:
                    type: integer
            total:
              type: integer

    # ===== Review =====
    Review:
      type: object
      properties:
        id:
          type: string
          format: uuid
        orderId:
          type: string
          format: uuid
        reviewerId:
          type: string
          format: uuid
        rating:
          type: integer
          minimum: 1
          maximum: 5
        comment:
          type: string
        createdAt:
          type: string
          format: date-time

    CreateReviewRequest:
      type: object
      required:
        - orderId
        - rating
      properties:
        orderId:
          type: string
          format: uuid
        rating:
          type: integer
          minimum: 1
          maximum: 5
        comment:
          type: string
          maxLength: 1000

    ReviewResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            review:
              $ref: '#/components/schemas/Review'

    ReviewsListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            reviews:
              type: array
              items:
                $ref: '#/components/schemas/Review'
            pagination:
              $ref: '#/components/schemas/Pagination'
            averageRating:
              type: number

    # ===== Invoice =====
    Invoice:
      type: object
      properties:
        id:
          type: string
          format: uuid
        orderId:
          type: string
          format: uuid
        invoiceNumber:
          type: string
        subtotal:
          type: number
        vatRate:
          type: number
        vatAmount:
          type: number
        total:
          type: number
        currency:
          type: string
        issueDate:
          type: string
          format: date-time
        dueDate:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/InvoiceStatus'
        pdfUrl:
          type: string

    InvoiceResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            invoice:
              $ref: '#/components/schemas/Invoice'

    InvoicesListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            invoices:
              type: array
              items:
                $ref: '#/components/schemas/Invoice'
            pagination:
              $ref: '#/components/schemas/Pagination'

    # ===== Payment =====
    Payment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        orderId:
          type: string
          format: uuid
        amount:
          type: number
        currency:
          type: string
        paymentMethod:
          $ref: '#/components/schemas/PaymentMethod'
        status:
          $ref: '#/components/schemas/PaymentStatus'
        stripePaymentId:
          type: string
        paidAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    ProcessPaymentRequest:
      type: object
      required:
        - orderId
        - paymentMethod
      properties:
        orderId:
          type: string
          format: uuid
        paymentMethod:
          $ref: '#/components/schemas/PaymentMethod'
        stripeToken:
          type: string

    PaymentResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            payment:
              $ref: '#/components/schemas/Payment'

    PaymentsListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            payments:
              type: array
              items:
                $ref: '#/components/schemas/Payment'
            pagination:
              $ref: '#/components/schemas/Pagination'

    # ===== Shipping =====
    CreateShipmentRequest:
      type: object
      required:
        - orderId
      properties:
        orderId:
          type: string
          format: uuid
        serviceCode:
          type: string

    ShipmentResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            trackingNumber:
              type: string
            labelUrl:
              type: string
            carrier:
              type: string

    TrackingResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            trackingNumber:
              type: string
            carrier:
              type: string
            status:
              $ref: '#/components/schemas/TrackingStatus'
            estimatedDelivery:
              type: string
              format: date-time
            events:
              type: array
              items:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
                  status:
                    $ref: '#/components/schemas/TrackingStatus'
                  location:
                    type: string
                  description:
                    type: string

    # ===== Enums =====
    PrintSize:
      type: string
      enum: [A4, A3, A5, SQUARE_20CM, SQUARE_30CM, CUSTOM]

    Material:
      type: string
      enum: [MATTE, GLOSSY, CANVAS, FINE_ART]

    Orientation:
      type: string
      enum: [PORTRAIT, LANDSCAPE, SQUARE]

    CustomizationType:
      type: string
      enum: [TEMPLATE_BASED, UPLOAD_OWN, FULLY_CUSTOM, DIGITAL_DOWNLOAD]

    ProductStatus:
      type: string
      enum: [ACTIVE, DRAFT, ARCHIVED, OUT_OF_STOCK]

    OrderStatus:
      type: string
      enum: [pending, confirmed, printing, shipped, delivered, cancelled]

    PaymentMethod:
      type: string
      enum: [STRIPE, PAYPAL, CARD, BANK_TRANSFER, CASH]

    PaymentStatus:
      type: string
      enum: [PENDING, COMPLETED, FAILED, REFUNDED, CANCELLED]

    InvoiceStatus:
      type: string
      enum: [DRAFT, ISSUED, PAID, OVERDUE, CANCELLED]

    TrackingStatus:
      type: string
      enum: [COLLECTED, IN_TRANSIT, OUT_FOR_DELIVERY, DELIVERED, ATTEMPTED_DELIVERY, RETURNED, EXCEPTION]
